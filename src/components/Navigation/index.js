import React, { useContext, useEffect, useState } from 'react'
import reduce from 'lodash/reduce'
import PropTypes from 'prop-types'

import StoreContext from '~/context/StoreContext'
import { UsePageState } from '~/context/pageContext'
import styled from '@emotion/styled'
import { breakpoints, colors } from '../../utils/styles'
import { CartCounter, Container, MidContainer, MenuLinkTitle, MenuLink, NavList, NavListItem, ThreeDotButton } from './styles'

const useQuantity = () => {
  const {
    store: { checkout },
  } = useContext(StoreContext)
  const items = checkout ? checkout.lineItems : []
  const total = reduce(items, (acc, item) => acc + item.quantity, 0)
  return [total !== 0, total]
}

const Navigation = ({ siteTitle }) => {
  const { Page } = UsePageState()
  const [hasItems, quantity] = useQuantity()

  const [navActive, setNavActive] = useState(false);


  useEffect(() => {
    const handleScroll = () => {
      if ((typeof window !== "undefined") && (Page === "home")) {
        setNavActive(window.pageYOffset <= 1 && true)
      }
    }
    window.addEventListener("scroll", handleScroll)

    if (Page === "home") {
      setNavActive(true)
    }
    else {
      setNavActive(false)
    }

    return () => window.removeEventListener("scroll", handleScroll);
  }, [Page]);

  const Wrapper = styled.div`
  background: ${colors.background};
  margin-bottom: 1.45rem;
  position:fixed;
  z-index:2;
  width:100vw;
  top: 0;
  `

  const TitleContainer = styled.div`
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:space-evenly;
  `

  const TitleImage = styled.svg`
  width:80%;
  height:auto;
  padding-top:1rem;
  `

  return (
    <Wrapper >
      <Container>
        <TitleContainer>
          < MenuLinkTitle to="/">INNOVATION INSPIRED BY NATURE</MenuLinkTitle>
          <TitleImage viewBox="0 0 744 173" fill="none" xmlns="http://www.w3.org/2000/svg">
            <svg width="744" height="173" viewBox="0 0 744 173" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M743.333 22.9733H719.533V-1.52588e-05H743.333V22.9733ZM743.333 47.8266H719.533V24.8533H743.333V47.8266ZM743.333 72.6933H719.533V49.72H743.333V72.6933ZM743.333 147.267H719.533V124.305H743.333V147.267ZM743.333 172.133H719.533V149.161H743.333V172.133ZM717.64 22.9733H693.827V-1.52588e-05H717.64V22.9733ZM717.64 47.8266H693.827V24.8533H717.64V47.8266ZM717.64 72.6933H693.827V49.72H717.64V72.6933ZM703.425 97.5466H693.827V74.5867H717.64V83.332C717.64 91.1826 711.276 97.5466 703.425 97.5466ZM717.64 147.267H693.827V138.521C693.827 130.671 700.192 124.307 708.041 124.307H717.64V147.267ZM717.64 172.133H693.827V149.161H717.64V172.133ZM691.947 22.9733H668.133V-1.52588e-05H691.947V22.9733ZM691.947 47.8266H668.133V24.8533H691.947V47.8266ZM691.947 72.6933H668.133V49.72H691.947V72.6933ZM691.947 97.5466H668.133V74.5867H691.947V97.5466ZM666.24 22.9733H642.44V-1.52588e-05H666.24V22.9733ZM666.24 47.8266H642.44V24.8533H666.24V47.8266ZM666.24 72.6933H642.44V49.72H666.24V72.6933ZM666.24 97.5466H642.44V74.5867H666.24V97.5466ZM666.24 122.413H642.44V99.4413H666.24V122.413ZM654.34 147.267C647.768 147.267 642.44 141.939 642.44 135.367V124.307H666.24V135.367C666.24 141.939 660.913 147.267 654.34 147.267ZM640.547 22.9733H616.733V-1.52588e-05H640.547V22.9733ZM640.547 47.8266H616.733V24.8533H640.547V47.8266ZM640.547 72.6933H616.733V49.72H640.547V72.6933ZM640.547 97.5466H616.733V74.5867H640.547V97.5466ZM640.547 122.413H616.733V99.4413H640.547V122.413ZM614.853 22.9733H591.041V-1.52588e-05H614.853V22.9733ZM614.853 47.8266H591.041V24.8533H614.853V47.8266ZM614.853 72.6933H591.041V49.72H614.853V72.6933ZM614.853 97.5466H591.041V74.5867H614.853V97.5466ZM614.853 122.413H591.041V99.4413H614.853V122.413ZM614.853 172.133H591.04V149.16H600.639C608.489 149.16 614.853 155.524 614.853 163.375V172.133ZM589.147 22.9733H565.345V-1.52588e-05H589.147V22.9733ZM589.147 47.8266H565.345V24.8533H589.147V47.8266ZM589.147 72.6933H565.345V49.72H589.147V72.6933ZM589.147 97.5466H565.345V74.5867H589.147V97.5466ZM589.147 122.413H565.345V99.4413H589.147V122.413ZM589.147 147.267H565.345V124.305H589.147V147.267ZM589.147 172.133H565.345V149.161H589.147V172.133ZM563.453 22.9733H539.641V-1.52588e-05H563.453V22.9733ZM563.453 47.8266H539.641V24.8533H563.453V47.8266ZM563.453 72.6933H539.641V49.72H563.453V72.6933ZM563.453 97.5466H539.641V74.5867H563.453V97.5466ZM537.76 22.9733H513.947V-1.52588e-05H537.76V22.9733ZM537.76 47.8266H513.947V24.8533H537.76V47.8266ZM537.76 97.5466H513.947V74.5867H537.76V97.5466ZM537.76 147.267H513.947V124.307H523.545C531.396 124.307 537.76 130.671 537.76 138.521V147.267ZM537.76 172.133H513.947V149.161H537.76V172.133ZM512.053 22.9733H488.253V-1.52588e-05H512.053V22.9733ZM512.053 47.8266H502.469C494.617 47.8266 488.253 41.4626 488.253 33.612V24.8533H512.053V47.8266ZM512.053 97.5466H499.733C493.393 97.5466 488.253 92.4066 488.253 86.0666C488.253 79.7266 493.393 74.5867 499.733 74.5867H512.053V97.5466ZM512.053 147.267H488.253V138.521C488.253 130.671 494.617 124.307 502.469 124.307H512.053V147.267ZM512.053 172.133H488.253V149.161H512.053V172.133ZM460.667 22.9733H436.853V-1.52588e-05H460.667V22.9733ZM460.667 47.8266H436.853V24.8533H460.667V47.8266ZM460.667 72.6933H436.853V49.72H460.667V72.6933ZM460.667 97.5466H436.853V74.5867H460.667V97.5466ZM460.667 122.413H436.853V99.4413H460.667V122.413ZM460.667 147.267H436.853V124.305H460.667V147.267ZM460.667 172.133H436.853V149.161H460.667V172.133ZM434.96 22.9733H411.16V-1.52588e-05H434.96V22.9733ZM434.96 47.8266H411.16V24.8533H434.96V47.8266ZM434.96 72.6933H411.16V49.72H434.96V72.6933ZM434.96 97.5466H411.16V74.5867H434.96V97.5466ZM434.96 122.413H411.16V99.4413H434.96V122.413ZM434.96 147.267H425.375C417.525 147.267 411.16 140.903 411.16 133.052V124.307H434.96V147.267ZM409.267 22.9733H385.465V-1.52588e-05H409.267V22.9733ZM409.267 47.8266H385.465V24.8533H409.267V47.8266ZM409.267 72.6933H385.465V49.72H409.267V72.6933ZM383.573 22.9733H359.76V-1.52588e-05H383.573V22.9733ZM383.573 47.8266H359.76V24.8533H383.573V47.8266ZM383.573 72.6933H359.76V49.72H383.573V72.6933ZM383.573 122.413H359.76V99.44H369.359C377.209 99.44 383.573 105.804 383.573 113.655V122.413ZM383.573 147.267H359.76V124.305H383.573V147.267ZM383.573 172.133H359.76V149.161H383.573V172.133ZM357.867 22.9733H334.067V-1.52588e-05H357.867V22.9733ZM357.867 47.8266H334.067V24.8533H357.867V47.8266ZM357.867 72.6933H334.067V49.72H357.867V72.6933ZM357.867 122.413H334.067V113.655C334.067 105.804 340.431 99.44 348.281 99.44H357.867V122.413ZM357.867 147.267H334.067V124.305H357.867V147.267ZM357.867 172.133H334.067V149.161H357.867V172.133ZM332.173 22.9733H308.373V-1.52588e-05H332.173V22.9733ZM332.173 47.8266H308.373V24.8533H332.173V47.8266ZM332.173 72.6933H308.373V49.72H332.173V72.6933ZM306.48 22.9733H282.667V-1.52588e-05H306.48V22.9733ZM306.48 47.8266H282.667V24.8533H306.48V47.8266ZM306.48 72.6933H282.667V49.72H306.48V72.6933ZM306.48 97.5466H282.667V74.5867H306.48V97.5466ZM306.48 122.413H282.667V99.4413H306.48V122.413ZM306.48 147.267H282.667V124.305H306.48V147.267ZM306.48 172.133H282.667V149.161H306.48V172.133ZM280.787 22.9733H256.973V-1.52588e-05H280.787V22.9733ZM280.787 47.8266H256.973V24.8533H280.787V47.8266ZM280.787 72.6933H256.973V49.72H280.787V72.6933ZM255.08 22.9733H231.28V-1.52588e-05H255.08V22.9733ZM255.08 47.8266H231.28V24.8533H255.08V47.8266ZM255.08 72.6933H231.28V49.72H255.08V72.6933ZM255.08 122.413H231.28V99.44H240.865C248.716 99.44 255.08 105.804 255.08 113.655V122.413ZM240.865 147.267H231.28V124.307H255.08V133.052C255.08 140.903 248.716 147.267 240.865 147.267ZM229.387 22.9733H205.573V-1.52588e-05H229.387V22.9733ZM229.387 47.8266H205.573V24.8533H229.387V47.8266ZM229.387 72.6933H205.573V49.72H229.387V72.6933ZM229.387 122.413H205.573V113.655C205.573 105.804 211.937 99.44 219.788 99.44H229.387V122.413ZM229.387 147.267H219.788C211.937 147.267 205.573 140.903 205.573 133.052V124.307H229.387V147.267ZM203.693 22.9733H179.88V-1.52588e-05H203.693V22.9733ZM203.693 47.8266H179.88V24.8533H203.693V47.8266ZM203.693 72.6933H179.88V49.72H203.693V72.6933ZM177.987 22.9733H154.187V-1.52588e-05H177.987V22.9733ZM177.987 47.8266H154.187V24.8533H177.987V47.8266ZM177.987 72.6933H154.187V49.72H177.987V72.6933ZM177.987 97.5466H154.187V74.5867H177.987V97.5466ZM177.987 122.413H154.187V99.4413H177.987V122.413ZM177.987 147.267H154.187V124.305H177.987V147.267ZM177.987 172.133H154.187V149.161H177.987V172.133ZM152.293 22.9733H128.48V-1.52588e-05H152.293V22.9733ZM152.293 47.8266H128.48V24.8533H152.293V47.8266ZM152.293 72.6933H128.48V49.72H152.293V72.6933ZM152.293 97.5466H128.48V74.5867H152.293V97.5466ZM152.293 122.413H128.48V99.4413H152.293V122.413ZM152.293 147.267H142.695C134.844 147.267 128.48 140.903 128.48 133.052V124.307H152.293V147.267ZM126.6 22.9733H102.787V-1.52588e-05H126.6V22.9733ZM126.6 47.8266H102.787V24.8533H126.6V47.8266ZM126.6 72.6933H102.787V49.72H126.6V72.6933ZM100.893 22.9733H77.0933V-1.52588e-05H100.893V22.9733ZM100.893 47.8266H77.0933V24.8533H100.893V47.8266ZM100.893 72.6933H77.0933V49.72H100.893V72.6933ZM100.893 122.413H77.0933V111.34C77.0933 104.767 82.4213 99.44 88.9933 99.44C95.5653 99.44 100.893 104.767 100.893 111.34V122.413ZM100.893 147.267H77.0933V124.305H100.893V147.267ZM100.893 172.133H77.0933V149.161H100.893V172.133ZM75.2 22.9733H51.3867V-1.52588e-05H75.2V22.9733ZM75.2 47.8266H51.3867V24.8533H75.2V47.8266ZM75.2 72.6933H51.3867V49.72H75.2V72.6933ZM75.2 172.133H51.3867V149.161H75.2V172.133ZM49.5067 22.9733H25.6933V-1.52588e-05H49.5067V22.9733ZM49.5067 47.8266H25.6933V24.8533H49.5067V47.8266ZM49.5067 72.6933H25.6933V49.72H49.5067V72.6933ZM49.5067 122.413H25.6933V111.347C25.6933 104.771 31.024 99.44 37.6 99.44C44.176 99.44 49.5067 104.771 49.5067 111.347V122.413ZM49.5067 147.267H25.6933V124.305H49.5067V147.267ZM49.5067 172.133H25.6933V149.161H49.5067V172.133ZM23.8 22.9733H0V-1.52588e-05H23.8V22.9733ZM23.8 47.8266H0V24.8533H23.8V47.8266ZM23.8 72.6933H0V49.72H23.8V72.6933Z" fill="#010101" />
            </svg>

          </TitleImage>
        </TitleContainer>
        <MidContainer>

          < MenuLinkTitle to="/about">
            About
        </MenuLinkTitle>

          {navActive ?
            <>
              <NavList>
                <NavListItem>Los Angeles, California</NavListItem>
                <NavListItem>@monks</NavListItem>
                <NavListItem>Subscribe to newsletter</NavListItem>
                <NavListItem>Terms & Shipping </NavListItem>
              </NavList>
              <ThreeDotButton onClick={() => setNavActive(navActive => !navActive)}>...
          </ThreeDotButton>
            </>
            :
            <ThreeDotButton onClick={() => setNavActive(navActive => !navActive)}>...
          </ThreeDotButton>
          }
        </MidContainer>
        <MenuLink to="/cart">
          {hasItems && <CartCounter>{quantity}</CartCounter>}
          Bag
        </MenuLink>
      </Container>
    </Wrapper >
  )
}

Navigation.propTypes = {
  siteTitle: PropTypes.string,
}

Navigation.defaultProps = {
  siteTitle: ``,
}

export default Navigation
